有约束的优化问题，往往要转化成无约束优化问题，

# 综述

- 最优性条件

  - 起作用约束？取等号的式子

  - 可行方向、下降方向、可行下降方向

  - 库恩塔克条件

    - Gordan引理

    - fritz john定理：当起作用的约束梯度线性相关时，此条件失效，加上不相关的条件就是kkt条件

    - 库恩塔克条件是必要条件，对于凸优化来说，是充要条件

- 制约函数法(:通过构造某种制约函数，将其加到非线性规划的目标函数中，从而将原来的约束极值问题转化成无约束极值)（序列无约束极小化技术SUMT：需要求解一系列无约束问题）

  - 罚函数法（外点法：达到最优解之前，往往在可行域外边迭代）

    - 构造一个罚函数，满足约束等于0，不满足约束就无穷大

    - 问题：构造的函数可能不连续（0和∞），无法求导

    - 解决办法：构造连续的函数，弱化∞，然后在罚函数前边乘上一个很大的数M（M叫惩罚因子），往往逐步增大惩罚因子。

    - M*罚函数叫做罚项，非线性规划➕罚项叫做罚函数

    - 阶跃函数：满足约束为0，不满足为1

    - 迭代步骤

      - 选取第一个惩罚因子，确定约束的允许误差

      - 求解当前惩罚因子对应的罚函数

      - 若存在任意一个不等式约束或者等式约束不满足条件，则增大惩罚因子，回到第二步继续迭代。否则停止迭代，当前点就是最优点

  - 障碍函数法（内点法）需要极小解不在边界上取得，从严格内点开始迭代，不能求解含等式约束的问题

    - 罚函数法，因为是从定义域外迭代的，不能取中间结果作为近似解使用

      - 如果要去每次的求解的近似解都是可行解，一边观察目标函数的改善情况

      - 如果目标函数在可行域外性质比较复杂，甚至无定义

    - 障碍函数、障碍因子、障碍项

    - 障碍因子随着迭代逐渐减少

    - 迭代步骤

      - 给定初始障碍因子和允许误差，必须从某一严格内点开始迭代

        - 找到初始内点的方法 ：

          - 先随便找到一个点，判断是否以严格不等式满足所有约束，若满足则以他为内点

          - 否则：以不能严格满足的约束作为目标函数，已经满足的约束形成障碍项，求解这一无约束问题，形成新的点，若不满足内点继续迭代，并减少障碍因子

      - 构造障碍函数，一般是对约束条件取倒数或者取对数

      - 求解障碍函数

      - 判断是否满足误差条件，否则继续迭代，障碍因子逐渐减少

  - 联合算法（混合法）：
    - 对等式约束和当前不被满足的不等式约束，使用罚函数法，对于已满足的不等式约束，使用障碍函数法



# 外点罚函数法

## 等式约束

对于问题
$$
min_x \quad f(x)\\
s.t. \quad c_i(x)=0,i=1,2,...,n
$$
构建的二次罚函数是
$$
P_E(x,\theta)=f(x)+\frac{1}{2}\theta\sum_{i=1}^nc_i^2(x)
$$
$\frac{1}{2}\theta\sum_{i=1}^nc_i^2(x)$称为惩罚项，$\theta>0$称为罚因子

这种方法是对不满足约束的点进行惩罚，在迭代过程中点一般会处于可行域之外，因此也叫做**外点罚函数**

## 不等式约束

$$
min_x \quad f(x)\\
s.t. \quad c_i(x)\leq0,i=1,2,...,n
$$

构建的二次罚函数为
$$
P_I(x,\theta)=f(x)+\frac{1}{2}\theta\sum_{i=1}^n\hat{c_i}^2(x)
$$
其中$\theta>0$,
$$
\hat{c_i}(x)=max\{c_i(x),0\}
$$

## 一般约束

$$
min_x \quad f(x)\\
s.t. \quad c_i(x)=0,i=1,2,...,m \\
\quad c_i(x)\leq 0,i=m+1,...,n
$$

二次罚函数
$$
P(x,\theta)=f(x)+\frac{1}{2}\theta[\sum_{i=1}^mc_i^2(x)+\sum_{i=m+1}^n\hat{c_i}^2(x)]
$$


# 内点罚函数


$$
min_x \quad f(x)\\
s.t. \quad c_i(x)\leq0,i=1,2,...,n
$$
定义对数惩罚
$$
P_I(x,\theta)=f(x)-\theta\sum_{i=1}^nln(-c_i(x))
$$
当$c_i(x)$趋向于0时，$-ln(-c_i(x))$会趋于无穷大，从而将点限制在可行域内



# 增广拉格朗日函数法

## 等式约束

$$
min_x \quad f(x)\\
s.t. \quad c_i(x)=0,i=1,2,...,n
$$

构造增广拉格朗日函数
$$
L_\theta(x,\lambda)=f(x)+\sum_{i=1}^n\lambda_ic_i(x)+\frac{1}{2}\theta\sum_{i=1}^nc_i^2(x)
$$
也就是在拉格朗日函数的基础上，增加了约束的二次罚函数

在第k步迭代中，给定$\theta_k$和$\lambda^k$
$$
\nabla_x L_{\theta_k}(x^{k+1},\lambda^k)=\nabla f(x^{k+1})+\sum_{i=1}^n(\lambda_i^k+\theta_kc_i(x^{k+1}))\nabla c_
i(x^{k+1})=0 \tag{1}
$$
对此优化问题，由拉格朗日函数，其最优解$x^*$,对应乘子$\lambda^*$满足
$$
\nabla f(x^*)+\sum_{i=1}^n \lambda_i^*\nabla c_i(x^*)=0 \tag{2}
$$
增广拉格朗日函数法产生的迭代点列要想收敛于$x^*$,则需要(1)(2)式在最优解处具有一致性，

因此，对于充分大的k，
$$
\lambda^*_i \approx \lambda^k_i+\theta_kc_i(x^{k+1}) \tag{3}
$$
也就是
$$
c_i(x^{k+1})\approx\frac{1}{\theta_k}(\lambda^*_i-\lambda^k_i)
$$
(3)式也给出了一个乘子有效的更新方式
$$
\lambda_i^{k+1}=\lambda_i^k+\theta_kc_i(x^{k+1})
$$


## 一般约束

对于一般约束问题
$$
min_x \quad f(x)\\
s.t. \quad c_i(x)=0,i=1,2,...,m \\
\quad c_i(x)\leq 0,i=m+1,...,n
$$
引入松弛变量，变换成等价形式
$$
min_x \quad f(x)\\
s.t. \quad c_i(x)=0,i=1,2,...,m \\
\quad c_i(x)+s_i= 0,i=m+1,...,n\\
s_i>0
$$
拉格朗日函数
$$
L(x,s,\lambda,\mu)=f(x)+\sum_{i=1}^{m}\lambda_ic_i(x)+\sum_{i=m+1}^{n}\mu_i(c_i(x)+s_i),s_i\geq 0
$$
记等式约束的二次罚函数为
$$
P(x,s)=\sum_{i=1}^{m}c_i^2(x)+\sum_{i=m+1}^{n}(c_i(x)+s_i)^2
$$
故，增广拉格朗日函数
$$
L_\theta(x,s,\lambda,\mu)=f(x)+\sum_{i=1}^{m}\lambda_ic_i(x)+\sum_{i=m+1}^{n}\mu_i(c_i(x)+s_i)+\frac{\theta}{2}p(x,s),s_i\geq 0
$$
在第k步迭代中，给定乘子$\lambda^k,\mu^k$和罚因子$\theta_k$，我们需要求解以下问题：
$$
min_{x,s} \quad L_{\theta_k}(x,s,\lambda^k,\mu^k)\\
s.t. s\geq 0
$$
固定x，关于s的子问题为
$$
min_s\quad \sum_{i=m+1}^{n}\mu_i(c_i(x)+s_i)+\frac{\theta_k}{2}\sum_{i=m+1}^{n}(c_i(x)+s_i)^2,s_i\geq 0
$$
为关于s的凸函数，根据凸优化的最优性理论，s为全局最优解，当且仅当
$$
s_i=max\{-\frac{\mu_i}{\theta_k}-c_i(x)\}
$$
将上式带入到增广拉格朗日函数中，然后可以利用梯度法求解

# KKT条件

考虑以下问题
$$
min_x \quad f(x)\\
s.t. \quad c_i(x)=0,i=1,2,...,m \\
\quad c_i(x)\leq 0,i=m+1,...,n
$$
其拉格朗日函数
$$
L(x,\lambda,\mu)=f(x)+\sum_{i=1}^m\lambda_ic_i(x)+\sum_{i=m+1}^n\mu_ic_i(x)
$$
对偶拉格朗日函数
$$
g(\lambda,\mu)=inf_{x} \quad L(x,\lambda,\mu)
$$
对偶问题为
$$
max_{\lambda,\mu}\quad g(\lambda,\mu)\\
s.t. \mu\geq 0
$$




KKT条件
$$
可行性条件：c_i(x*)=0,i=1,2,...,m\\
			c_i(x^*)\leq 0 ,i=m+1,...,n\\
			
对偶可行性条件：\mu_i\geq 0 \\
互补松弛性条件：\mu_ic_i(x^*)=0\\
稳定性条件：\nabla f(x^*)+\sum_{i=1}^m\lambda_i \nabla c_i(x)+\sum_{i=m+1}^n\mu_i \nabla c_i(x)=0\\
$$


